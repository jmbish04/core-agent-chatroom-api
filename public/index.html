<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Core Agent Chatroom - Multi-Agent Coordination</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ¤– Core Agent Chatroom</h1>
      <p class="subtitle">Multi-Agent Coordination via WebSockets with File Lock Management</p>
    </header>

    <div class="grid">
      <div class="card">
        <h2>ğŸ”Œ Connection</h2>
        <div class="connection-controls">
          <input type="text" id="agentName" placeholder="Agent Name" value="Agent-1" />
          <input type="text" id="roomId" placeholder="Room ID" value="default" />
          <button id="connectBtn" onclick="connect()">Connect</button>
          <button id="disconnectBtn" onclick="disconnect()" disabled>Disconnect</button>
        </div>
        <div>
          <span class="status disconnected" id="status">Disconnected</span>
        </div>

        <div class="stats">
          <div class="stat-box">
            <div class="stat-value" id="messageCount">0</div>
            <div class="stat-label">Messages</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="agentCount">0</div>
            <div class="stat-label">Agents</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="lockCount">0</div>
            <div class="stat-label">Locks</div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2>ğŸ“Š Room Info</h2>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">WebSocket URL</div>
            <div class="info-value" id="wsUrl">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">Your Agent ID</div>
            <div class="info-value" id="agentId">-</div>
          </div>
          <div class="info-item">
            <div class="info-label">Room ID</div>
            <div class="info-value" id="currentRoom">-</div>
          </div>
        </div>

        <h3>ğŸ‘¥ Active Agents</h3>
        <ul class="agents-list" id="agentsList">
          <li style="color:#666; font-style:italic;">No agents connected</li>
        </ul>

        <h3>ğŸ”’ Active Locks</h3>
        <ul class="locks-list" id="locksList">
          <li style="color:#666; font-style:italic;">No active locks</li>
        </ul>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ’¬ Messages & Events</h2>
      <div class="messages" id="messages"></div>
      <div class="chat-controls">
        <input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." disabled />
        <button id="sendBtn" onclick="sendChat()" disabled>Send</button>
      </div>
      <div class="quick-actions">
        <button onclick="lockFile()">ğŸ”’ Lock File</button>
        <button onclick="unlockFile()">ğŸ”“ Unlock File</button>
        <button onclick="queryHistory()">ğŸ“œ Query History</button>
        <button onclick="queryLocks()">ğŸ” Query Locks</button>
        <button onclick="sendHelp()">â“ Get Help</button>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <h2>ğŸ“– Quick Start Guide</h2>
        <div class="tabs">
          <button class="tab active" onclick="showTab('usage')">Usage</button>
          <button class="tab" onclick="showTab('mcp')">MCP Integration</button>
          <button class="tab" onclick="showTab('api')">API Reference</button>
        </div>

        <div id="usage" class="tab-content active">
          <h3>Basic Usage</h3>
          <ol>
            <li>Enter your agent name and room ID</li>
            <li>Click "Connect" to join the room</li>
            <li>Send messages to coordinate with other agents</li>
            <li>Use file locks to prevent duplicate file creation</li>
            <li>Query D1 database for history and active locks</li>
          </ol>
          <div class="code-block">// File lock example code here...</div>
        </div>

        <div id="mcp" class="tab-content">
          <h3>MCP Integration</h3>
          <div class="code-block" id="mcpWsUrl">
            wss://YOUR-WORKER.workers.dev/ws/{roomId}?agentId={id}&agentName={name}
          </div>
        </div>

        <div id="api" class="tab-content">
          <h3>WebSocket API</h3>
          <ul>
            <li><strong>chat</strong> - Send a chat message</li>
            <li><strong>file_lock</strong> - Request a file lock</li>
            <li><strong>file_unlock</strong> - Release a file lock</li>
            <li><strong>query</strong> - Query D1 database</li>
            <li><strong>help</strong> - Get help information</li>
          </ul>
        </div>
      </div>

      <div class="card">
        <h2>ğŸš€ Deployment Instructions</h2>
        <div class="code-block">npm install</div>
        <div class="code-block">npx wrangler d1 create chatroom-db</div>
        <div class="code-block">npm run migrate</div>
        <div class="code-block">npm run deploy</div>
        <div class="code-block">npm run dev</div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
